<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="../js/header.js"></script>
<script src="../js/util.js"></script>
<script src="../js/bootstrap-rating.min.js"></script>
<script src="../js/jquery.spinner.min.js"></script>
<script src="../js/jquery.range-min.js"></script>
<link href="../css/bootstrap-rating.css" rel="stylesheet">
<link href="../css/bootstrap-spinner.min.css" rel="stylesheet">
<link href="../css/jquery.range.css" rel="stylesheet">
<title>NurseHub</title>

<script>
function loadShiftType(){
	var res= getJson("/admin/loadShiftType");
	
	var cont = "";
	for(i in res){
		cont = cont + "<tr>";
		
		
		for(j in res[i]){
			if(j=="id"){
			}else if(j=="used"){
				if(res[i][j]==true){
					cont = cont + "<td>âˆš</td>";
				}else{
					cont = cont + "<td></td>";
				}
				
			}else if(j=="score"){
				cont = cont + "<td><input type='hidden' class='rating' data-readonly data-fractions='2' value='" + res[i][j] + "'/></td>";
			}else{
				cont = cont + "<td>" +res[i][j] + "</td>";
			}
		}
		
		var edit = 'onclick="editShiftType(\'' + res[i].id + '\')"';
		var drop = 'onclick="dropShiftType(\'' + res[i].id + '\')"';
		cont = cont + "<td style=\"text-align:right\">"
      		+ "<button class=\"btn btn-primary\" " + edit +">Edit</button>"
      		+ "<button class=\"btn btn-danger\" " + drop +">Drop</button>"
     	 	+ "</td></tr>"
	}
	$("#shiftType").html(cont);
}

function editShiftType(id){
	window.location.href="/admin/editShiftType.html?id="+id;
}

function dropShiftType(id){
	window.location.href="/admin/deleteShiftType?id="+id;
}

function loadShiftDemand(){
	var res= getJson("/admin/loadShiftDemand");
	
	var cont = "";
	for(i in res){
		cont = cont + "<tr id='shiftDemandTr'>";
		
		
		cont = cont + "<td><input type='text' class='form-control' readonly='readonly' name='name' value='"
			+ res[i].name + "'></td>";
		
		var arr = new Array();
		var idx=0;
		for(k in res[i]){
			arr[idx] = res[i][k];
			idx = idx+1;
		}
		//5 level
		for(j=2;j<7;j++){
			cont = cont + "<td><div data-trigger='spinner' class='input-group'>" 
				+ "<span class='input-group-btn'><button type='button' disabled='disabled' class='btn spinBtn' data-spin='down'>-</button></span>" 
				+ "<input type='text' data-ruler='quantity' data-min='0' class='form-control level' readonly='readonly' name='lv"
				+ (j-1) + "' value='" + arr[j] + "' ";
			if(arr[j]>arr[j+5]){cont += "style='color:blue'>";}
			else if(arr[j]<arr[j+5]){cont += "style='color:red'>";}
			else{cont += ">";}
			cont = cont + "<span class='input-group-addon ref'><i>" + arr[j+5] + "</i></span>"
				+ "<span class='input-group-btn'><button type='button' disabled='disabled' class='btn spinBtn' data-spin='up'>+</button></span></div></td>"

		}
		var edit = 'onclick="editShiftDemand(this)"';
		var useREF = 'onclick="refShiftDemand(this)"';
		cont = cont + "<td style=\"text-align:right\">"
      		+ "<button class=\"btn btn-primary btn-sm\" " + edit +">Edit</button>"
     	 	+ "<button class=\"btn btn-success btn-sm\" " + useREF +">UseREF</button>"
     	 	+ "</td>";
		cont = cont + "<td><input type='text' style='display:none' class='form-control' readonly='readonly' name='id' value='"
			+ res[i].id + "'></td></tr>";
     	 	
	}
	$("#shiftDemand").html(cont);
	
	
}

function editShiftDemand(obj){
	var tr = $(obj).parent().parent();
	if($(obj).text() == "Edit"){
		$(obj).text("Save");
		tr.find(".level").removeAttr("readonly");
		tr.find(".spinBtn").attr("disabled",false);
	}else{
		$(obj).text("Edit");
		var form = jsonify(tr);
		sendJson("/admin/updateShiftDemand",form);
		window.location.href="strategy.html";
	}
}

function refShiftDemand(obj){
	var tr = $(obj).parent().parent();
	for(var i=0;i<5;i++){
		tr.find(".level").eq(i).val(tr.find(".ref").eq(i).text());
	}
	var form = jsonify(tr);
	sendJson("/admin/updateShiftDemand",form);
	window.location.href="strategy.html";
	
	
}

function loadTimeLimit(){
	$("#demoGreen").val(1);	
	$("#demoBlue").val(1);
	$('#demoGreen').jRange({
		from: 0,
	    to: 1,
	    step: 0.5,
	    format: '%s',
	    width: 50,
	    showLabels: false,
	    showScale:false,
	    snap: true,
	    theme:'theme-green',
	    disable: true
	});
	$('#demoBlue').jRange({
		from: 0,
	    to: 1,
	    step: 0.5,
	    format: '%s',
	    width: 50,
	    showLabels: false,
	    showScale:false,
	    snap: true,
	    theme:'theme-blue',
	    disable: true
	});
	
	var res = getJson("/admin/loadTimeLimit");
	$("#minTime").val(res.minTime);	
	$("#maxTime").val(res.maxTime);
	$("#minTimeRec").val(res.minTimeRec);	
	$("#maxTimeRec").val(res.maxTimeRec);	
	$('#minTime').jRange({
		from: 0,
	    to: 100,
	    step: 0.5,
	    format: '%s',
	    width: 600,
	    showLabels: true,
	    showScale:false,
	    snap: true,
	    disable: true
	});
	$('#minTimeRec').jRange({
		from: 0,
	    to: 100,
	    step: 0.5,
	    format: '%s',
	    width: 600,
	    showLabels: false,
	    snap: true,
	    theme:'theme-blue',
	    disable: true
	});
	$('#maxTime').jRange({
		from: 0,
	    to: 100,
	    step: 0.5,
	    format: '%s',
	    width: 600,
	    showLabels: true,
	    showScale:false,
	    snap: true,
	    disable: true
	});
	$('#maxTimeRec').jRange({
		from: 0,
	    to: 100,
	    step: 0.5,
	    format: '%s',
	    width: 600,
	    showLabels: false,
	    snap: true,
	    theme:'theme-blue',
	    disable: true
	});
}


function editTimeLimit(){
	var btn = $("#editBtn");
	if(btn.text() == "Edit"){
		btn.text("Save");
		$("#minTime").jRange('enable');
		$("#maxTime").jRange('enable');
	}else{
		btn.text("Edit");
		var form = $("#timeLimitForm").jsonify();
		sendJson("/admin/updateTimeLimit",form);
		loadTimeLimit();
		$("#minTime").jRange('disable');
		$("#maxTime").jRange('disable');
		$("td,th").addClass("text-center");
	}
}


function setRecTimeLimit(){
	$("#minTime").jRange('enable');
	$("#maxTime").jRange('enable');
	$("#minTime").val($("#minTimeRec").val());	
	$("#maxTime").val($("#maxTimeRec").val());
	var form = $("#timeLimitForm").jsonify();
	sendJson("/admin/updateTimeLimit",form);
	loadTimeLimit();
	window.location.href="strategy.html";
}
</script>

</head>
<body>
<a id="top"></a>
<!-- nav -->
 <nav class="navbar navbar-default" role="navigation">
 	<div class="container-fluid">
 	<div class="navbar-header">
        <a class="navbar-brand" href="/admin/notice.html">NurseHub</a>
    </div>
    <div>
        <ul class="nav navbar-nav">
            <li ><a href="notice.html">Notice</a></li>
            <li class="active"><a href="strategy.html">Strategy</a></li>
            <li><a href="roster.html">Roster</a></li>
            <li><a href="approval.html">Approval</a></li>
            <li><a href="staff.html">Staff</a></li>
        </ul>
    </div>
    <div style="text-align:right">
    	<p id="welcome"></p>
    	<a href="/login/quit">quit</a>
    </div>
	</div>
 </nav>
 

 <div class="row">
  	<!-- mark nav -->
	<div class="col-xs-2 col-md-1">
		<ul class="nav nav-pills nav-stacked" data-toggle="buttons">
			<li><a href="#shiftTypeMark" onclick="window.location.hash='#shiftTypeMark'">Shift Type</a></li>
		<!-- 
			<li><a href="#shiftRuleMark" >Shift Rule</a></li>
		-->
			<li><a href="#shiftDemandMark" onclick="window.location.hash='#shiftDemandMark'">Shift Demand</a></li>
			<li><a href="#timeLimitMark" onclick="window.location.hash='#timeLimitMark'">Time Limit</a></li>
		</ul>
	</div>
	
	<div class="col-xs-10 col-md-11">
		<div class="panel panel-primary">
		    <a id="shiftTypeMark"></a>
		    <div class="panel-heading">
		        <h3 class="panel-title">Shift Type</h3>
		        
	
		    </div>
		    <div class="panel-body">
		    	<table class="table table-striped">
				  <caption><button class="btn btn-success" onclick="editShiftType('')">Add New Type</button></caption>
				  <thead>
				  <tr>
				  	<th>Name</th>
				  	<th>BeginTime</th>
				  	<th>EndTime</th>
				  	<th>Total(h)</th>
				  	<th>In Use</th>
				  	<th>Score</th>
				  	<th></th>
				  </tr>
				  </thead>
				  <tbody id="shiftType" >
				  </tbody>
				</table>
		    </div>
		</div>
<!--  
		<div class="panel panel-info" >
			<a name="shiftRuleMark"></a>
		    <div class="panel-heading">
		        <h3 class="panel-title">Shift Rule</h3>
		    </div>
		    <div class="panel-body">
		    	<p>Shift Rule</p>
		    </div>
		</div>
-->

		<div class="panel panel-success">
		    <a id="shiftDemandMark"></a>
		    <div class="panel-heading">
		        <h3 class="panel-title">Shift Demand</h3>
		    </div>
		    <div class="panel-body">
		    	<table class="table table-striped">
				  <caption>
				  	<p>Set The Shift's Demands of People Number for Each Level</p>
				  	<p>The <i>Italic Number</i> is Recommended by Staff for Reference.</p>
				  </caption>
				  <thead>
				  <tr>
				  	<th style='display:none'>ID</th>
				  	<th>ShiftName</th>
				  	<th><abbr title="Nurse">N0</abbr></th>
				  	<th><abbr title="Nurse Practitioner">N1</abbr></th>
				  	<th><abbr title="Nurse-in-charg">N2</abbr></th>
				  	<th><abbr title="Associate Professor of Nursing">N3</abbr></th>
				  	<th><abbr title="Professor of Nursing">N4</abbr></th>
				  	<th style='width:14%'></th>
				  </tr>
				  </thead>
				  <tbody id="shiftDemand" >
				  </tbody>
				</table>
		    </div>
		</div>
		
		<div class="panel panel-warning" >
			<a id="timeLimitMark"></a>
		    <div class="panel-heading">
		        <h3 class="panel-title">Time Limit</h3>
		    </div>
		    <div class="panel-body">
				 <div style="color:gray">
				 	<span style="margin-left:60px" >:The Time Limit Matron Set</span>
				 	<input id="demoGreen" type="hidden" class="slider-input" />
				 </div>
				 <br>
				 <div  style="color:gray">
			  		<span style="margin-left:60px" >:The Time Limit Recommend by Staff for Reference</span>
			  		<input id="demoBlue"  type="hidden" class="slider-input"/>
				 </div>
			
		    	<form id="timeLimitForm">
		    		<br>
		    		<div class="input-group">
			  			<span class="input-group-addon">Min Work Time(h/week)</span>
			  			<input id="minTime"  name="minTime" type="hidden" class="slider-input" />
			  			<input id="minTimeRec"  name="minTimeRec" type="hidden" class="slider-input"/>
			  		</div>
			  		<br>
			  		<div class="input-group">
			  			<span class="input-group-addon">Max Work Time(h/week)</span>
			  			<input id="maxTime" name="maxTime"  type="hidden" class="slider-input" />
			  			<input id="maxTimeRec"  name="maxTimeRec" type="hidden" class="slider-input" />
			  		</div>
			  		<br>
			  		<div>
			  			<button  id="editBtn" type="button" class="btn btn-primary" onclick="editTimeLimit()">Edit</button>
			  			<button  id="autoBtn" type="button" class="btn btn-success" onclick="setRecTimeLimit()">UseREF</button>
			  		</div>
				</form>
		    </div>
		</div>
	</div>
</div>
<div style="text-align:right"><button class="btn btn-primary" onclick="window.location.hash='#top'">TOP</button></div>

<script>
//$("#welcome").text("welcome " + checkLogin() );
loadShiftType();
loadShiftDemand();
loadTimeLimit();
$("td,th").addClass("text-center");
rollBack();
 </script>
</body>
</html>