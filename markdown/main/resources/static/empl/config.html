<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="../js/header.js"></script>
<script src="../js/util.js"></script>
<title>NurseHub</title>
<script>
var user;
function loadUser(){
	user = getJson("/empl/getUserById?id=" + getUserId());
	$("#nickName").val(user.nickName);
	$("#name").val(user.name);
	$("#workLevel").val("N"+(user.workLevel-1));
	if(user.isManager==true){
		$("#isManager").val("√");
	}else{
		$("#isManager").val("×");
	}
}
function changePwd(){
	if($("#rawPassword").val() != user.password){
		alert("raw password err");
		return;
	}
	if($("#newPassword").val() != $("#confirmPassword").val()){
		alert("new password  confirm err");
		return;
	}
	user.password = $("#newPassword").val();
	sendJson("/empl/changePassword",user);
}

function changeNickName(){
	if($("#password").val() != user.password){
		alert("password err");
		return;
	}
	if($("#newNickName").val() == ""){
		alert("nick name can't be empty");
		return;
	}
	user.nickName = $("#newNickName").val();
	var check = sendJson("/empl/checkNickName",user)
	if(check.exist=="true"){
		alert("the nick name exists");
	}else{
		sendJson("/empl/changeNickName",user);
	}
}
</script>
</head>

<body>
<a id="top"></a>
<!-- nav -->
 <nav class="navbar navbar-default" role="navigation">
 	<div class="container-fluid">
 	<div class="navbar-header">
        <a class="navbar-brand" href="/empl/notice.html">NurseHub</a>
    </div>
    <div>
        <ul class="nav navbar-nav">
            <li><a href="notice.html">Notice</a></li>
            <li><a href="preference.html">Preference</a></li>
            <li><a href="application.html">Application</a></li>
            <li class="active"><a href="config.html">Config</a></li>
        </ul>
    </div>
    <div style="text-align:right">
    	<p id="welcome"></p>
    	<a href="/login/quit">quit</a>
    </div>
	</div>
 </nav>
 
 <div class="row">
  	<!-- mark nav -->
	<div class="col-xs-2 col-md-1">
		<ul class="nav nav-pills nav-stacked" data-toggle="buttons">
			<li><a href="#profileMark" >Profile</a></li>
		</ul>
	</div>
	
	<div class="col-xs-10 col-md-11">
		<div class="panel panel-primary">
		    <a name="profileMark"></a>
		    <div class="panel-heading">
		        <h3 class="panel-title">Profile</h3>
		    </div>
		    <div class="panel-body">
		    	<div style="margin:10px;" class="input-group">
		    		<span class="input-group-addon">NickName</span>
			  		<input id="nickName" type="text"  class="form-control" readonly="readonly"/>
			  		<span class="input-group-addon">Name</span>
			  		<input id="name" type="text"class="form-control" readonly="readonly"/>
				</div>
				<div style="margin:10px;" class="input-group">
					<span class="input-group-addon">WorkLevel</span>
			  		<input id="workLevel" type="text" class="form-control" readonly="readonly"/>
			  		<span class="input-group-addon">Manager</span>
			  		<input id="isManager" type="text" class="form-control" readonly="readonly" />
				</div>
				<div style="margin:10px;" class="input-group">
					<button id="changePws" class="btn btn-success" data-toggle="modal" data-target="#myModal">Change Password</button> 
					<button id="changeNickName" class="btn btn-warning" data-toggle="modal" data-target="#nickModal">Change NickName</button> 
				</div>
		    </div>
		</div>
		
	</div>
	
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	            </div>
	            <div class="modal-body">
	            	<div style="margin:10px;" class="input-group">
		    			<span class="input-group-addon">Raw Password: </span>
			  			<input id="rawPassword" type="text"  class="form-control"/>
			  		</div>
			  		<div style="margin:10px;" class="input-group">
		    			<span class="input-group-addon">New Password: </span>
			  			<input id="newPassword" type="text"  class="form-control"/>
			  		</div>
			  		<div style="margin:10px;" class="input-group">
		    			<span class="input-group-addon">Confirm Password: </span>
			  			<input id="confirmPassword" type="text"  class="form-control"/>
			  		</div>
			  		<div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		                <button type="button" class="btn btn-primary" onclick="changePwd()" data-dismiss="modal">Confirm</button>
		            </div>
	            </div>
	        </div><!-- /.modal-content -->
	    </div><!-- /.modal -->
	</div>
	
	<div class="modal fade" id="nickModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	            </div>
	            <div class="modal-body">
	            	<div style="margin:10px;" class="input-group">
		    			<span class="input-group-addon">New NickName: </span>
			  			<input id="newNickName" type="text"  class="form-control"/>
			  		</div>
			  		<div style="margin:10px;" class="input-group">
		    			<span class="input-group-addon">Password: </span>
			  			<input id="password" type="text"  class="form-control"/>
			  		</div>
			  		<div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		                <button type="button" class="btn btn-primary" onclick="changeNickName()" data-dismiss="modal">Confirm</button>
		            </div>
	            </div>
	        </div><!-- /.modal-content -->
	    </div><!-- /.modal -->
	</div>
</div>

<div style="text-align:right"><button class="btn btn-primary" onclick="window.location.hash='#top'">TOP</button></div>
<script>
loadUser();
$("#welcome").text("welcome " + checkLogin() );
</script>
</body>
</html>